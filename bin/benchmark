#!/bin/bash

if [ "$#" -ne 3 ]; then
	echo "usage: benchmark filename target-name(bbb|bbai64) input-size"
	exit
fi

FILENAME=$(basename ${1})

if [ ${2} == "bbb" ]; then
	BBB_HOSTNAME=root@192.168.7.2
	BENCH_CMD="./iree-benchmark-module --module_file=/tmp/$FILENAME --device=local-sync:// --function_input=1x${3}xf32=0 --entry_function=forward --benchmark_repetitions=10"
elif [ ${2} == "bbai64" ]; then
	BBB_HOSTNAME=debian@192.168.7.2
	BENCH_CMD="./iree-benchmark-module --module_file=/tmp/$FILENAME --device=local-sync:// --function_input=1x${3}xf32=0 --entry_function=main --benchmark_repetitions=10"
else
	exit
fi

scp $1 $BBB_HOSTNAME:/tmp/$FILENAME
SETUP_CMD="cd /tmp"

CLEANUP_CMD="cd /tmp && rm /tmp/$FILENAME"

ssh $BBB_HOSTNAME $BENCH_CMD
# ssh $BBB_HOSTNAME $CLEANUP_CMD

exit
